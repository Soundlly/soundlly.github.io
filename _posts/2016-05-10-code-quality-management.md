---
layout: post
title: 사운들리 코드 품질 관리 이야기
author: humbledude
subdir: code-quality-management
comments: true
---

오늘은 사운들리의 코드 품질 관리에 대해 이야기 해보려 합니다.  
몇몇 개발자에게는 지루하고 악몽같은 이야기일 수 있겠네요.  
제 경우에는 예전에는 이런 품질이라는 단어를 멀리했지만 결국 제가 작성한 코드에 발목을 많이 잡히다 보니, 자연스레 관심을 갖게 되었습니다.

일단, 어떤 소프트웨어가 좋은 품질의 소프트웨어일까요?

## 좋은 품질이란?

책에 나올법한 내용을 보면, 아래와 같은 항목을 토대로 소프트웨어 품질을 판단한다고 합니다.

### ISO/IEC 9126 : Software engineering - Product quality

- **Functionality**: 명시된 요구사항을 잘 충족했는지
- **Reliability**: 명시된 조건과 시간 아래에서 일정 성능을 유지 하는지
- **Usability**: 사용하기 위해 어느정도의 노력과 자원이 필요한지
- **Efficiency**: 소모 자원과 성능간의 효율
- **Maintainability**: 수정하기 위해 어느정도의 노력이 필요한지
- **Portability**: 다른 환경에서도 사용 할수 있는지

출처: <https://en.wikipedia.org/wiki/ISO/IEC_9126>

뭔가 복잡해 보이지만, 결국 개발자라면 위의 항목은 누구나 추구하게 되는 가치라고 생각 합니다.

그런데 말입니다. 이런 좋은 내용을 마음 속으로만 간직한 채 코드를 작성하면 정말 좋은 소프트웨어를 만들 수 있을까요? 저는 객관적인 방법으로 코드를 평가한다면 좋은 피드백이 될 것이라고 생각합니다. (물론 이 성적표를 남에게 보여주는 것과는 다른 문제에요 ㅎㅎ)

## 어떻게 품질을 체크하는가

소프트웨어의 품질을 체크하는 데에 다양한 방법과 툴이 제시되고 있는데요, 저는 크게 두 가지로 분류 해보겠습니다.

- **유저 입장** : 유저의 요구사항에 맞는 소프트웨어인지 체크
- **개발자 입장** : 내가 지금 이 코드를 의도한 대로 잘 작성하고 있는지 체크

유저 입장의 품질은 언급하지 않아도 중요함을 누구나 알고 있습니다. 이 부분이 만족이 되지 않으면 제품이 아니죠! 그래서 저는 개발자 입장에서 스스로 챙길수 있는 품질을 사운들리는 어떻게 챙겨보고 있는 지 이야기 해보도록 하겠습니다. ~~실은 제가 개발자 입니다 ㅎㅎ~~
사운들리 개발자의 코드는 아래와 같이 흘러갑니다.

{% include image.html subdir=page.subdir name='soundlly-code-quality-management.png' caption='그림1. 사운들리 코드 개발상의 품질 관리 순서도' %}

간단히 각 항목을 훑어 보겠습니다.

### Local Machine

각자 갖고 있는 맥북으로, 다양한 IDE를 사용해 코딩합니다. 그리고 git 을 이용해 commit 하고, github 에 push 하죠.

### Github

push 된 수정사항은 pull request 를 통해 동료에게 알려집니다. 이후 코드리뷰를 통해 merge 하게 됩니다.
코드리뷰는 많은 사람들에 의해 그 중요성이 부각되고 있습니다. 사운들리는 같은 모듈을 만드는 개발자끼리, 그리고 다른 모듈에 영향을 주는 코드일 경우에는 해당 모듈의 개발자도 리뷰를 합니다.
코드리뷰를 통해 다른 사람이 어떤 기능을 작성했는지 보고, 오류도 찾고, 더 좋은 방법이 있으면 공유도 하고, 칭찬도 하고, 훈수도 두고 합니다.
참고로 사운들리는 git-flow 정책에 따라 git branch를 운영하고 있습니다.

### Jenkins

Github 에 commit 이 등록되면 Jenkins 는 자동으로 빌드를 시작 합니다. Jenkins 는 단순 빌드 성공 실패를 떠나서, 코드 품질에 대한 몇가지 report 를 발생 시킵니다. 아래에서 좀더 자세히 다뤄보겠습니다.

### SonarQube

Jenkins 에서 빌드하면서 SonarQube 에 포함된 분석 기능을 사용하게 됩니다.  
그렇다면, 코드 품질의 지표는 무엇일까요?  
Jenkins가 발생시키는 레포트를 통해서 알 수 있는 내용은 아래와 같습니다.


이 네 가지 레포트는 객관적 수치를 나타내주기 때문에 일종의 코드 품질 지표로 삼을 수 있습니다. 물론 이 지표만 잘 관리 했다고 해서 좋은 코드를 작성했다고 말할 수는 없습니다. 다만 좋은 코드를 작성하기 위한 기초 중의 기초라고 볼 수 있겠죠 :)

품질 체크를 위한 툴(tool)은 개발 언어에 따라 다를 수 있습니다.

사운들리에서는 다양한 언어로 소프트웨어가 작성되어 있습니다. 따라서 언어마다 위의 결과를 얻기 위해서 서로 다른 툴을 사용하고 있습니다.

|                   | Android                                  | Java                                     | Javascript                               | C/C++                                    |
| ----------------- | ---------------------------------------- | ---------------------------------------- | ---------------------------------------- | ---------------------------------------- |
| **코딩 스타일**        | [checkstyle](http://checkstyle.sourceforge.net/) | [checkstyle](http://checkstyle.sourceforge.net/) | [jshint](http://jshint.com/)             | [cppcheck](http://cppcheck.sourceforge.net/) |
| **Unit test**     | [junit](http://junit.org/junit4/)        | [junit](http://junit.org/junit4/)        | [mocha](https://github.com/mochajs/mocha) | [googletest](https://github.com/google/googletest) |
| **Code coverage** | [jacoco](http://eclemma.org/jacoco/)     | [cobertura](http://cobertura.github.io/cobertura/) | [mocha-cov](https://github.com/mmoulton/grunt-mocha-cov) | [gcov](https://gcc.gnu.org/onlinedocs/gcc/Gcov.html) |
| **정적 분석**         | [sonarqube](http://www.sonarqube.org/)   | [sonarqube](http://www.sonarqube.org/)   | [sonarqube](http://www.sonarqube.org/)   | [cppcheck](http://cppcheck.sourceforge.net/) |

각 개발자는 위의 네 가지 결과를 얻기 위해서 빌드 시스템에 툴을 포함하여 개발하고 있습니다. 제가 주로 개발하고 있는 java 언어에 해당하는 툴들을 좀 더 자세히 살펴보겠습니다.

### checkstyle

- 코딩 스타일을 체크 해줍니다. xml 파일로 미리 정의 되어있고요. 매번 빌드할때마다 스타일이 틀린것을 지적해 줍니다.
- 코딩 스타일은 중요합니다. 같이 개발하는 개발자와 코딩 스타일이 같다면 마치 내가 작성한 코드처럼 쉽게 읽을 수 있죠.

### JUnit

junit 은 자바 유닛 테스트 프레임워크 입니다. 유닛 테스트 코드를 편하게 작성하게 해주고, 쉽게 테스트 결과를 볼 수 있습니다.유닛 테스트 코드를 작성하면 내가 작성한 모듈을 작은 단위로 테스트 해서, 작은 로직에서 발생하는 시시콜콜한 문제를 방지 할 수 있습니다. 테스트 코드를 작성해서 검증한 부분은 스스로도 신뢰가 갑니다.기능 수정간에 유닛 테스트에서 fail 이 나는 경우가 발생하는데, 모르는 사이에 다른 모듈에 영향을 준 것을 알게 됩니다. 다른 모듈에 모르고 영향을 주게 되면 뒷처리가 어려워지잖아요~

### Cobertura

code coverage 를 계산해 주는 툴입니다.유닛 테스트 코드가 실행되면, 작성된 코드의 각 부분을 실행하게 됩니다. cobertura 는 이때 각 코드의 어느부분이 실행되었는지 확인해서 통계를 내줍니다.주로 line coverage / branch coverage 두 지표를 보는데요, line coverage 는 해당 라인이 한번이라도 실행 되면 check 되고, branch coverage 는 각 라인에 있는 조건문을 다 따로 check 합니다. 당연히 branch coverage 를 달성하는게 어렵겠죠?

### SonarQube

소나큐브는 다양한 plug-in 을 통해서 정적 분석을 하고, 시각화를 해주는 툴입니다.사운들리는 주로 정적 분석 용도로만 소나큐브를 사용하고 있습니다. (지원하는 plug-in 을 보면 젠킨스와 기능이 겹치는 부분이 있습니다.)정적분석으로 실제 문제가 되는 부분을 찾는 경우도 있고, minor 한 부분에 대한 지적을 하는 경우도 있습니다. 그러나 이런 minor 한 부분도 꼼꼼하게 잘 챙겨야 좋은 개발자가 된다고 믿고 있습니다.


## 마치며

여기까지 사운들리의 코드 품질 관리에 대해 이야기 해보았습니다. 품질 관리를 해보신 분은 아시겠지만, 이런 툴을 쓰다보면 항상 행복하게 코드 품질을 관리할 수는 없습니다.

매달 세워놓은 목표를 달성하기 위해서 뼈를 깎는 노력으로 테스트 코드를 작성해야 되고, 당장 기능 수정해서 배포해야 되는데, 작성해 둔 테스트 케이스가 Fail 되어 말썽을 부릴 수도 있습니다.
그렇지만 객관적 기준으로 코드 품질을 관리하다보면 어느샌가 큰 노력없이 좋은 코드를 작성하는 개발자가 되지 않을까 생각해 봅니다. 코드 졸면서 막 짜도 style warning 0건/ 정적분석 오류없음 / 테스트 코드 기본 탑재 뭐 이런 개발자 말입니다 ㅎㅎ
다른 개발자분들은 어떻게 자신이 작성한 코드의 품질을 관리하고 있는지 궁금하네요.

알고 계신 좋은 방법이 있다면 언제든지 공유 부탁드리겠습니다~!

오늘의 블로그 포스팅은 여기서 마치겠습니다.

읽어주셔서 감사합니다 :)
